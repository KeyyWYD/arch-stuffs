#!/bin/bash

GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

if command -v yay &> /dev/null; then
  AUR="yay"
elif command -v paru &> /dev/null; then
  AUR="paru"
fi

_header() {
  echo -e "${CYAN}╭──────────────────────────────────────────────────────╮"
  echo "│               󰣇 SYSTEM UPDATE UTILITY                │"
  echo -e "╰──────────────────────────────────────────────────────╯${NC}"
}

_updates() {
  if [ -f "$HOME/.cache/updcount" ] && [ "$(cat "$HOME/.cache/updcount")" -eq 0 ]; then
    echo  -e "${YELLOW} :: No updates available.${NC}"
    sleep 2
    exit 0
  else
    echo -e "${CYAN}╭─ Available Updates 󰮯 ────────────────────────────────╮"
    checkupdates | sed 's/^/│  /'    
    echo -e "${CYAN}╰──────────────────────────────────────────────────────╯${NC}"    
    echo
  fi
}

clear
_header
_updates

while true; do
  echo -en "${CYAN}Do you wish to install updates now? [Y/n]: "
  read -r user_choice

  case "$user_choice" in
    y|Y)
      echo
      echo -e "${YELLOW}:: Starting updates...${NC}"
      echo

      $AUR -Syu --noconfirm

      echo -e "${GREEN}:: Update(s) completed successfully.${NC}"
      echo 0 > "$HOME/.cache/updcount"
      notify-send "System Update" "Update(s) completed successfully."
      exit 0
      ;;
    n|N)
      echo
      echo -e "${YELLOW}:: Update(s) cancelled. Exiting.${NC}"
      sleep 0.4
      exit 0
      ;;
    *)
      echo -e "${RED}Invalid choice. Please enter 'y' or 'n'.${NC}"
      ;;
  esac
done
