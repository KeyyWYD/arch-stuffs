#!/usr/bin/env bash

# Icons Folder
icon_dir="$HOME/.config/dunst/assets/"

get_volume() {
  local vol=$(pamixer --get-volume-human | tr -d '%')
  echo "$vol%"
}

get_icon() {
  local new_vol=$(get_volume)
  if [[ "${new_vol%\%}" -le 20 ]]; then
    echo "$icon_dir/volume-off.svg"
  elif [[ "${new_vol%\%}" -le 40 ]]; then
    echo "$icon_dir/volume-low.svg"
  elif [[ "${new_vol%\%}" -le 60 ]]; then
    echo "$icon_dir/volume-medium.svg"
  else
    echo "$icon_dir/volume-high.svg"
  fi
}

notify_user() {
  if [[ "$(get_volume)" == "Muted" ]]; then
    notify-send -e -r 91190 -t 800 -h int:value:"$(get_volume | sed 's/%//')" -h string:x-canonical-private-synchronous:volume_notif -u low -i "$(get_icon)" "Volume: $(get_volume)"
  else
    notify-send -e -r 91190 -t 800 -h int:value:"$(get_volume | sed 's/%//')" -h string:x-canonical-private-synchronous:volume_notif -u low -i "$(get_icon)" "Volume: $(get_volume)"
  fi
}

toggle_mute() {
	if [ "$(pamixer --get-mute)" == "false" ]; then
		pamixer -m >/dev/null
		notify-send -e -r 91190 -t 800 -u low -i "$icon_dir/volume-mute.svg" "Muted"
	elif [ "$(pamixer --get-mute)" == "true" ]; then
		pamixer -u >/dev/null
		notify-send -e -r 91190 -t 800 -u low -i "$(get_icon)" "Volume: $(get_volume)"
	fi
}

inc_volume() {
  if [ "$(pamixer --get-mute)" == "true" ]; then
    toggle_mute
  else
    pamixer -i 2 >/dev/null
    notify_user
  fi
}

dec_volume() {
  if [ "$(pamixer --get-mute)" == "true" ]; then
    toggle_mute
  else
    pamixer -d 2 >/dev/null
    notify_user
  fi
}

case $1 in
  --get)
    get_volume
    ;;
  --inc)
    inc_volume
    ;;
  --dec)
    dec_volume
    ;;
  --toggle)
    toggle_mute
    ;;
  *)
    get_volume
    ;;
esac
