#!/bin/bash

monitor=$(hyprctl monitors | awk '/^Monitor/{name=$2} /focused: yes/{print name}')
cache_file="$HOME/.cache/swww/$monitor"

matugen image "$(cat "$cache_file")"

progs=(
  'waybar'
  'dunst'
)

for prog in "${progs[@]}"; do
  pkill -f "$prog" 2> /dev/null
done

for prog in "${progs[@]}"; do
  if [ "$prog" != "dunst" ]; then
    nohup "$prog" > /dev/null 2>&1 &
  fi
done

hyprctl reload config-only > /dev/null
